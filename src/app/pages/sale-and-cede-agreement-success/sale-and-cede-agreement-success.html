<div class="container py-4 py-md-5 container-lg">
  <div class="row justify-content-center g-4 g-xl-5">
    <div class="col-12 col-lg-8 col-xxl-7">

      <!-- Top bar -->
      <div class="d-flex align-items-center justify-content-between mb-3">
        <a class="btn btn-outline-secondary btn-sm rounded-pill shadow-sm" href="/">
          <i class="bi bi-arrow-left"></i>
          <span class="ms-2">Home</span>
        </a>
        <div class="small text-muted d-none d-md-block">Secure • Encrypted</div>
      </div>

      <div class="card shadow-lg border-0 rounded-4">
        <!-- Header -->
        <div class="card-header bg-white border-0 py-4">
          <h1 class="h5 fw-bold mb-1 d-flex align-items-center gap-2">
            <i class="bi"
               [ngClass]="{
                 'bi-check-circle text-success': state === 'done',
                 'bi-hourglass-split text-warning': state === 'working' || state === 'init',
                 'bi-x-circle text-danger': state === 'error'
               }"></i>
            <span>Sale &amp; Cede – Status</span>
          </h1>
          <div class="text-muted" *ngIf="(state === 'working' || state === 'done') && method">
            Paid by <span class="fw-semibold text-uppercase">{{ method }}</span>
            • <span class="fw-semibold">R{{ amountZar }}</span>
          </div>
        </div>

        <!-- Body -->
        <div class="card-body">
          <!-- INIT -->
          <div *ngIf="state === 'init'">
            <div class="alert alert-info-subtle border border-info-subtle rounded-3 small">
              <i class="bi bi-info-circle"></i>
              Preparing your agreement…
            </div>
          </div>

          <!-- WORKING -->
          <div *ngIf="state === 'working'">
            <div class="d-flex align-items-center">
              <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
              <span class="ms-2">Generating your agreement…</span>
            </div>
            <div class="form-text mt-2">This usually takes a few seconds.</div>
          </div>

          <!-- DONE -->
          <div *ngIf="state === 'done'">
            <div class="alert alert-success-subtle border border-success-subtle rounded-3">
              <i class="bi bi-check-circle"></i>
              {{ message || 'Agreement generated and emailed successfully.' }}
            </div>

            <div class="d-flex flex-wrap gap-2 mt-3">
              <a class="btn btn-primary rounded-pill" href="/">
                <i class="bi bi-house"></i> Back to Home
              </a>
              <a *ngIf="result?.pdf_path" class="btn btn-outline-secondary rounded-pill" [href]="result.pdf_path" target="_blank" rel="noopener">
                <i class="bi bi-file-earmark-pdf"></i> Download PDF
              </a>
              <a *ngIf="result?.docx_path" class="btn btn-outline-secondary rounded-pill" [href]="result.docx_path" target="_blank" rel="noopener">
                <i class="bi bi-file-earmark-word"></i> Download DOCX
              </a>
            </div>

            <div class="small text-muted mt-2">
              If you don’t see the email in a few minutes, check your spam folder or contact support.
            </div>
          </div>

          <!-- ERROR -->
          <div *ngIf="state === 'error'">
            <div class="alert alert-danger rounded-3">
              <i class="bi bi-x-circle"></i>
              {{ message || 'Something went wrong while generating your agreement.' }}
            </div>
            <div class="d-flex flex-wrap gap-2">
              <a class="btn btn-outline-secondary rounded-pill" href="/">
                <i class="bi bi-house"></i> Back to Home
              </a>
              <a class="btn btn-primary rounded-pill" href="/contact">
                <i class="bi bi-life-preserver"></i> Contact Support
              </a>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>